SnortSocket
===========
A NodeJS listener to capture [Snort][3] events via the UNIX Socket output plugin, alert_unixsock
--------------------------------------------------------------------

This project aims to provide a simple listener for the alerts raised by the popular [Snort][3] IDS, 
allowing for custom actions to be fired in response to the alerts.

## Basics
The following shows the simplest way to start listening for [Snort][3] alerts, using the default 
options and echoing the alert information to the screen:

    var SnortSocket = require('snort-socket').SnortSocket;
    var socket = new SnortSocket();
    socket.on('alert', function(a) { console.log(util.inspect(a)); });
    socket.bind('/var/log/snort/snort_alert');

	
## Dependencies
* [Snort][3], _Baker, Roesch, SourceFire Inc._
This project is designed to capture alerts emitted by the Snort IDS, so Snort is required to 
generate these alerts.

* [unix-dgram][2], _Ben Noordhuis, et al_
Required when using NodeJS v0.6+, as native support for UNIX Datagram sockets was removed.
Optional when using lesser versions of NodeJS, but can be invoked using the `forceUnixDgram` option
(see below).
	
## Setting up
You should include the following output plugin configuration in your `snort.conf` (or 
`barnyard.conf`, if you prefer):

    output alert_unixsock
	
The NodeJS script that executes consuming code should run on the same machine and under the same 
user account as the [Snort][3] daemon, otherwise [Snort][3] will not write to the socket created by
NodeJS.  This may be resolvable with the correct owner/group permissions but these are not 
controllable via the SnortSocket object.



## API
The module provides the following objects/methods:

### Object: `SnortSocket([options]);`

Creates a new instance of the `SnortSocket` listener.

#### Examples
* `var s = new SnortSocket();`
* `var s = new SnortSocket({ bigEndian: true });`

#### Options
`options` is an object hash that can contain the following values:

* `alertMessageLength`	_[Number; defaults to `256`]_ <br />
  Defines the maximum length of the message that will be emitted by [Snort][3].  This is not 
  expected to change from `256` but, if future/custom versions of [Snort][3] are released with a
  different value, this option will allow SnortSocket to be made to match.  This should always be 
  made to tally with the `ALERTMSG_LENGTH` definition in the source code of your version of 
  [Snort][3].

* `snapshotLength`		_[Number; defaults to `65536`]_ <br />
  Defines the maximum length of the data packet included in alerts emitted by [Snort][3].  Earlier
  versions of [Snort][3] had this fixed to `1500`, but more-recent versions have increased this to
  `65536`.  This should always be made to tally with the `SNAPLEN` definition in the source code 
  of your version of [Snort][3].

* `forceUnixDgram`		_[Boolean; defaults to `false`]_ <br />
  If `true`, SnortSocket will use the [`unix-dgram`][2] module to create the underlying UNIX 
  datagram socket, regardless of the running version of NodeJS; otherwise, the native `dgram` 
  module is used in versions of NodeJS less than v0.6.

* `bigEndian`			_[Boolean; defaults to `false`]_ <br />
  If `true`, reads integers from the alert data using big-endian read routines; otherwise uses the
  little-endian routines.  This does not affect data that is read from the packet snapshot, which 
  should always be in network order (big endian).  This may need to be set to `true` on known
  big-endian platforms (although I do not run one for test purposes).

* `debug`				_[Boolean; defaults to `false`]_ <br />
  If `true`, spools debug messages to the console; otherwise the SnortSocket runs with no output.


### Method: `socket.bind(socketPath, [callback]);`

Binds the listener to the supplied `socketPath`.

#### Parameters
* `socketPath` 			_[String; no default]_ <br />
The path to the `snort_alert` socket, which typically exists in the logging directory configured
in `snort.conf`.  If a file already exists with that path, it is first unlinked (deleted) before
the socket is bound.

* `callback`			_[Function(err:Error); default `function() { }`]_ <br />
A function to be run once the bind operation is completed.  If an error occurs during the bind
process, it is passed as the first argument to this function; otherwise the bind is successful.

#### Example
* `socket.bind('/var/log/snort/snort_alert');`
* `socket.bind('/var/log/snort/snort_alert', function(err) { if (!!err) throw err; });`


### Method: `socket.close([callback]);`

Closes the underlying socket, preventing further alerts from being handled.

#### Parameters
* `callback`			_[Function(); default `function() { }`]_ <br />
A function to be run once the close operation is completed and the underlying socket has emitted
its close event.

#### Example
* `socket.close(function() { console.log('closed'); });`
* `socket.close();`


### Event: `listening`	_[Function()]_

Emitted by the SnortSocket when it has initialized and is actively listening for alerts

### Event: `error`		_[Function(err:Error)]_

Emitted by the SnortSocket when it has recovered from an exception.  The raised exception will be
passed as the first parameter to the handler function

### Event: `close`		_[Function(didError:Boolean)]_

Emitted by the SnortSocket when it has disconnected from the underlying socket and is no longer
listening for events.  If the underling socket closed because of an exception, `didError` will be
`true`; otherwise `false`

### Event: `alert`		_[Function(alert:Alert)]_

Emitted by the SnortSocket when it has received an alert from the [Snort][3] IDS.  Details of the
alert are provided as the first parameter to the handler function; see the Alert object section


## Alerts
Alerts details are emitted by the `alert` event, as an nested object hash with a number of 
properties describing the event.  These properties are as follows:

* `message`					_[String]_ &mdash; Descriptive text for the alert
* `protocol.ip`				_[Number]_ &mdash; The IP version of the packet that caused the alert
* `protocol.id`				_[Number]_ &mdash; The protocol number for the packet (e.g. 6 = TCP; 17 = UDP)
* `protocol.name`			_[String]_ &mdash; A name representation of the protocol ID (e.g. `tcp`, `udp`)
* `protocol.fields` 		_[Object]_ &mdash; Reserved for protocol-specific fields (e.g. ICMP type)
* `source.address`			_[String]_ &mdash; The IP address from which the alerting packet arrived
* `source.port`				_[Number]_ &mdash; The TCP/UDP port on which the alerting packet arrived
* `destination.address`		_[String]_ &mdash; The IP address to which the alerting packet was sent
* `destination.port`		_[Number]_ &mdash; The TCP/UDP port to which the alerting packet was sent
* `event.id`				_[Number]_ &mdash; A unique event ID provided by [Snort][3]
* `event.ref`				_[Number]_ &mdash; A reference to a previous event ID, if linked
* `event.class`				_[Number]_ &mdash; The alert classification value provided by [Snort][3]
* `event.priority`			_[Number]_ &mdash; The alert priorty value provided by [Snort][3]
* `event.timestamp.seconds`	_[Number]_ &mdash; The alert time, in number of seconds since 1970-01-01T00:00:00Z
* `event.timestamp.micros`	_[Number]_ &mdash; The number of microseconds in addition to the alert time in seconds
* `event.timestamp.date`	_[Date]_ &mdash; The JS date representation of the alert time (to nearest millisecond)


## Compatibility Issues
* The `alert_unixsock` output plugin for [Snort][3] only works in UNIX/Linux-type systems; 
  likewise, the SnortSocket module is only supported on UNIX/Linux-type systems
* Earlier versions of NodeJS had native support for UNIX datagram sockets, but this was removed in
  v0.6.  The optional dependency [`unix-dgram`][2] is required for use with NodeJS v0.6+
* The UNIX datagram support in earlier versions of NodeJS limited the maximum size of a received
  datagram to 65,536B.  Newer versions of Snort exceed this datagram size, which makes capturing
  full details of the alert impossible.  As such, SnortSocket will only work with the older, native
  UNIX datagram module if the Snort code was compiled with a `SNAPLEN` value (and, subsequently,
  the SnortSocket object was created with the `snapshotLength` option) small enough to fit inside 
  the 65,536B limit.  If not, the use of [`unix-dgram`][3] must be forced with the `forceUnixDgram`
  option.

	
## Licensing
The SnortSocket code is licensed under the MIT license, where applicable, which is included at the 
top of each source file and is duplicated below:

>	Copyright (c) 2012 Jamie Barnes
>   
>	Permission is hereby granted, free of charge, to any person obtaining a copy of this 
>	software and associated documentation files (the "Software"), to deal in the Software 
>	without restriction, including without limitation the rights to use, copy, modify, merge, 
>	publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons 
>	to whom the Software is furnished to do so, subject to the following conditions:
>    
>	The above copyright notice and this permission notice shall be included in
>	all copies or substantial portions of the Software.
>    
>	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING
>	BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND 
>	NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
>	DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, 
>	OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.  
	
The SnortSocket code does not include any portion of the [Snort][3] codebase but can read data exported 
by [Snort][3], which requires knowledge of the data format derived from the [Snort][3] source files.  As 
such, some artifacts from the original source files may exist within the SnortSocket source, in
reference comments, but these do not form part of the executing code.

This project is not affiliated with the [Snort][3] project, or its creators/maintainers, and no
warranty, copyright or ownership regarding the [Snort][3] project is implied.  For the avoidance of 
doubt, however, [Snort][3] is licensed under the General Public License v2, the full text of which is 
available at [http://www.gnu.org/licenses/gpl-2.0.html][1].

----
_$Id: readme.md 22 2012-06-19 21:54:09Z jimbobmcgee $_

[1]: http://www.gnu.org/licenses/gpl-2.0.html
[2]: https://github.com/bnoordhuis/node-unix-dgram/
[3]: http://www.snort.org/